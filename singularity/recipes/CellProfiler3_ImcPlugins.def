BootStrap: docker
From: ubuntu:xenial
IncludeCmd: yes

# See:
# https://github.com/CellProfiler/CellProfiler/wiki/Source-installation-%28Ubuntu-16.04-LTS%29
# https://github.com/BodenmillerGroup/ImcPluginsCP

%post

# Get the Dependencies not installed with pip
	apt-get update
	apt-get -y upgrade
	apt-get -y install \
		build-essential \
		cython \
		git \
		libmysqlclient-dev \
		libhdf5-dev \
		libxml2-dev \
		libxslt1-dev \
		openjdk-8-jdk \
		python-dev \
		python-pip \
		python-pytest \
		python-vigra \
		python-wxgtk3.0

# Install CellProfiler v3.1.9
	cd /opt
	git clone https://github.com/CellProfiler/CellProfiler.git
	cd CellProfiler
	git checkout v3.1.9
	pip install --force-reinstall --upgrade pip 
	  pip install \
		boto3==1.9.60 \
		numpy==1.15.4 \
		centrosome==1.1.6 \
        docutils==0.14 \
		h5py==2.8.0 \
		inflect==2.1.0 \
		javabridge==1.0.18 \
		joblib==0.13.0 \
		mahotas==1.4.5 \
		matplotlib==2.2.3 \
		mysqlclient==1.3.13 \
		prokaryote==2.4.1 \
		python-bioformats==1.5.2 \
		pyzmq==15.3.0 \
		raven==6.9.0 \
		requests==2.20.1 \
		scikit-image==0.14.0 \
		scikit-learn==0.20.1 \
		scipy==1.1.0 \
		six==1.11.0 \
		pillow==4.3 \
		networkx==2.
	pip install .

# ImcPluginsCP are installed just by copying them into the CellProfiler/plugins folder
	cd /opt
	git clone https://github.com/BodenmillerGroup/ImcPluginsCP.git
	cp ImcPluginsCP/plugins/*.py /opt/CellProfiler/plugins
	rm -r ImcPluginsCP
